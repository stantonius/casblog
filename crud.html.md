# CRUD


<!-- WARNING: THIS FILE WAS AUTOGENERATED! DO NOT EDIT! -->

``` python
# fc_tool_info()
```

Tools available from `fastcore.tools`:

- &`rg`: Run the `rg` command with the args in `argstr` (no need to
  backslash escape)
- &`sed`: Run the `sed` command with the args in `argstr` (e.g for
  reading a section of a file)
- &`view`: View directory or file contents with optional line range and
  numbers
- &`create`: Creates a new file with the given content at the specified
  path
- &`insert`: Insert new_str at specified line number
- &`str_replace`: Replace first occurrence of old_str with new_str in
  file
- &`strs_replace`: Replace for each str pair in old_strs,new_strs
- &`replace_lines`: Replace lines in file using start and end
  line-numbers

``` python
from fastcore.tools import *
```

------------------------------------------------------------------------

<a
href="https://github.com/stantonius/casblog/blob/main/casblog/crud.py#L19"
target="_blank" style="float:right; font-size:smaller">source</a>

### fetch_gist_markdown

>  fetch_gist_markdown (gist_url:str)

*Fetch markdown content and filename from a gist URL.*

------------------------------------------------------------------------

<a
href="https://github.com/stantonius/casblog/blob/main/casblog/crud.py#L34"
target="_blank" style="float:right; font-size:smaller">source</a>

### get_db

>  get_db (prod:bool=False)

*Get database connection.*

``` python
db = get_db(prod=False)
assert db.tables, "Database should have tables"
```

## Add Post

------------------------------------------------------------------------

<a
href="https://github.com/stantonius/casblog/blob/main/casblog/crud.py#L39"
target="_blank" style="float:right; font-size:smaller">source</a>

### save_post

>  save_post (db, post:casblog.core.Post)

*Save a Post to the given database, returning new Post with id.*

------------------------------------------------------------------------

<a
href="https://github.com/stantonius/casblog/blob/main/casblog/crud.py#L45"
target="_blank" style="float:right; font-size:smaller">source</a>

### parse_categories

>  parse_categories (s:str)

*Convert comma-separated string to JSON array string.*

## Sync from Notebook

Read content from `.ipynb` files in `/data` and update posts in the
database. Useful for syncing local notebooks to dev/prod after edits.

------------------------------------------------------------------------

<a
href="https://github.com/stantonius/casblog/blob/main/casblog/crud.py#L51"
target="_blank" style="float:right; font-size:smaller">source</a>

### read_notebook_markdown

>  read_notebook_markdown (path, skip_first:bool=False)

*Read a Jupyter notebook and extract content as markdown.*

- Markdown cells are included as-is
- Code cells are wrapped in \`\`\`python blocks
- Cells starting with \#| directives are skipped

Args: path: Path to .ipynb file skip_first: If True, skip the first cell
(often metadata/links)

``` python
# Test read_notebook_markdown
content = read_notebook_markdown(PROJECT_ROOT / "data" / "how_to_read.ipynb")
assert "Filter Framework" in content, "Should contain main content"
assert "```python" not in content or content.count("```python") >= 0, "Code blocks formatted"
print(f"Extracted {len(content)} chars, first 200:\n{content[:200]}...")
```

------------------------------------------------------------------------

<a
href="https://github.com/stantonius/casblog/blob/main/casblog/crud.py#L84"
target="_blank" style="float:right; font-size:smaller">source</a>

### update_post

>  update_post (db, slug:str, **kwargs)

*Update an existing post by slug.*

Args: db: Database connection slug: Post slug to find \*\*kwargs: Fields
to update (content, title, categories, etc.)

Returns: True if post was found and updated, False otherwise

``` python
# Test update_post
dev_db = get_db(prod=False)
assert update_post(dev_db, 'nonexistent-slug', content='test') == False, "Should return False for missing post"
print("update_post validation passed")
```

------------------------------------------------------------------------

<a
href="https://github.com/stantonius/casblog/blob/main/casblog/crud.py#L106"
target="_blank" style="float:right; font-size:smaller">source</a>

### sync_notebook_to_post

>  sync_notebook_to_post (db, slug:str, notebook_path,
>                             skip_first:bool=False)

*Read notebook content and update the matching post.*

Args: db: Database connection slug: Post slug to update notebook_path:
Path to .ipynb file skip_first: Skip first cell of notebook

Returns: True if successful, False if post not found

``` python
post_gist = "https://gist.github.com/stantonius/1124934653f070d345ec4a19c57695f5"
```

``` python
content, filename = fetch_gist_markdown(post_gist)

try:
    post = Post(
        title=input(f"Title [{filename}]: ").strip() or filename.replace('.md', ''),
        content=content,
        slug=input("Slug (or Enter to auto-generate): ").strip() or None,
        categories=parse_categories(input("Categories (comma-separated): "))
    )
except KeyboardInterrupt:
    print("\nCancelled.")


saved = save_post(get_db(prod=True), post)
```

## Delete Post

``` python
try:
    # Fetch all posts from prod
    prod_db = get_db(prod=True)
    posts = list(prod_db.t.post.rows)

    # Display posts
    print("Posts in prod database:\n")
    for p in posts:
        print(f"  {p['id']}: {p['title']}")

    # Get selection
    ids_str = input("\nEnter post IDs to delete (comma-separated), or Enter to cancel: ").strip()
    if not ids_str:
        print("Cancelled.")
    else:
        ids = [int(i.strip()) for i in ids_str.split(',')]
        
        # Show what will be deleted
        print(f"\n‚ö†Ô∏è  About to delete {len(ids)} post(s):")
        for pid in ids:
            p = next((p for p in posts if p['id'] == pid), None)
            if p: print(f"  - {p['title']}")
        
        # Confirm
        confirm = input("\nType 'DELETE' to confirm: ").strip()
        if confirm == 'DELETE':
            for pid in ids:
                prod_db.t.post.delete(pid)
                print(f"üóëÔ∏è  Deleted post id={pid}")
            print("\n‚úÖ Done!")
        else:
            print("Cancelled.")
except KeyboardInterrupt:
    print("\nCancelled.")
```

    Posts in prod database:

      2: Token & Embeddings Refresh
      4: RAG Fundamentals
      5: How to Read

    ‚ö†Ô∏è  About to delete 1 post(s):
      - RAG Fundamentals
    üóëÔ∏è  Deleted post id=4

    ‚úÖ Done!
